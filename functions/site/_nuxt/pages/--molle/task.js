(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{420:function(t,e,o){"use strict";o.r(e);o(16);var r=o(5),n=o(8),l=o(9),c=o(4),d=o(7),f=(o(6),o(2)),m=o(17),v=(o(11),o(26)),h=o(57),y=o(20);function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,r=Object(c.a)(t);if(e){var n=Object(c.a)(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return Object(l.a)(this,o)}}var _=function(t,e,o,desc){var r,n=arguments.length,l=n<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,o):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(l=(n<3?r(l):n>3?r(e,o,l):r(e,o))||l);return n>3&&l&&Object.defineProperty(e,o,l),l},k=function(t){Object(n.a)(o,t);var e=D(o);function o(){var t;return Object(r.a)(this,o),(t=e.apply(this,arguments)).opt={dt:B.dt,dtOrder:B.dt.arr},t.commentData=[],t.addCommentData={body:"",taskId:"",timestamp:null,author:""},t.taskMetaData={},t.taskBodyData={},t}return Object(m.a)(o,[{key:"head",value:function(){return{title:"[TASK]{{MOLLE CMS v0.1}}"}}},{key:"created",value:function(){}},{key:"updateValue",value:function(){var t=this;if(this.$set(this,"taskMetaData",this.metaData[this.$route.query.id]),this.unsubscribe&&this.unsubscribe(),this.$route.query.id){var e=B.tasksBodyRef.doc(this.$route.query.id).onSnapshot((function(e){t.$set(t,"taskBodyData",e.data())})),o=B.tasksBodyRef.where("taskId","==",this.$route.query.id).onSnapshot((function(e){var o=[];e.forEach((function(t){var data=t.data();o.push(data)})),t.$set(t,"commentData",o)}));this.unsubscribe=function(){e(),o()}}}},{key:"update",value:function(t,e){var o={cmd:"update",data:{}};"meta"==t?(o.ref=B.tasksMetaRef.doc(this.$route.query.id),o.data[e]=this.metaData[this.$route.query.id][e]):(o.ref=B.tasksBodyRef.doc(this.$route.query.id),o.data[e]=this.taskBodyData[e]);var r=[o];y.a.updateBatch(r)}},{key:"addComment",value:function(){var t=this,e=[];this.addCommentData.taskId=this.$route.query.id,this.addCommentData.timestamp=v.a.firestore.FieldValue.serverTimestamp(),this.addCommentData.author=v.a.auth().currentUser.uid;var o=B.tasksBodyRef.doc().id;e.push({cmd:"set",ref:B.tasksBodyRef.doc(o),data:this.addCommentData}),y.a.updateBatch(e).then((function(){t.$set(t,"addCommentData",{body:""})}))}}]),o}(f.Vue);_([Object(f.Prop)()],k.prototype,"metaData",void 0),_([Object(f.Prop)()],k.prototype,"users",void 0),_([Object(f.Watch)("$route.query.id")],k.prototype,"updateValue",null);var M=k=_([Object(f.Component)({components:{TextAreaQuill:h.a}})],k),j=o(10),C=Object(j.a)(M,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.$route.query.id&&t.taskMetaData?o("div",[o("div",{staticClass:"modal",attrs:{"aria-expanded":!!t.$route.query.id}},[o("div",{staticClass:"modal__fiexd"},[o("div",{staticClass:"modal__close",on:{click:function(e){return t.$router.replace({query:{}})}}}),o("div",{staticClass:"modal__body bootstrap"},[o("label",{staticClass:"form-inline"},[o("span",{staticClass:"mr-2"},[t._v(t._s(t.opt.dt.title.jp)+":")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.taskMetaData.title,expression:"taskMetaData.title"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.taskMetaData.title},on:{change:function(e){return t.update("meta","title")},input:function(e){e.target.composing||t.$set(t.taskMetaData,"title",e.target.value)}}})]),o("label",{staticClass:"form-inline"},[o("span",{staticClass:"mr-2"},[t._v("担当者:")]),o("select",{directives:[{name:"model",rawName:"v-model",value:t.taskMetaData.holder,expression:"taskMetaData.holder"}],staticClass:"form-control",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.taskMetaData,"holder",e.target.multiple?o:o[0])}}},[o("option",{attrs:{value:""}},[t._v("未設定")]),t._l(t.$users,(function(e,r){return o("option",{domProps:{value:r,innerHTML:t._s(e.name)}})}))],2)]),o("label",{staticClass:"form-inline"},[o("span",{staticClass:"mr-2"},[t._v(t._s(t.opt.dt.limitDate.jp)+":")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.taskMetaData.limitData,expression:"taskMetaData.limitData"}],staticClass:"form-control",attrs:{type:"date"},domProps:{value:t.taskMetaData.limitData},on:{change:function(e){return t.update("meta","limitDate")},input:function(e){e.target.composing||t.$set(t.taskMetaData,"limitData",e.target.value)}}})]),o("div",{domProps:{innerHTML:t._s(t.taskBodyData.description)}}),o("hr"),t._l(t.commentData,(function(e){return o("div",[o("div",{domProps:{innerHTML:t._s(e.body)}}),o("p",[t._v(t._s(e.author))]),e.timestamp&&e.timestamp.toDate?o("p",[t._v(t._s(e.timestamp.toDate().toLocaleString({timeZone:"Asia/Tokyo"})))]):t._e()])})),o("hr"),o("TextAreaQuill",{attrs:{label:"コメント:",toolbar:"full"},model:{value:t.addCommentData.body,callback:function(e){t.$set(t.addCommentData,"body",e)},expression:"addCommentData.body"}}),o("div",{staticClass:"d-flex"},[o("div"),o("button",{staticClass:"btn-primary",on:{click:t.addComment}},[o("span",[o("b-icon",{attrs:{icon:"plus"}})],1)])])],2)])])]):t._e()}),[],!1,null,null,null).exports,O=o(164);function R(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,r=Object(c.a)(t);if(e){var n=Object(c.a)(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return Object(l.a)(this,o)}}var $,x=function(t,e,o,desc){var r,n=arguments.length,l=n<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,o):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(l=(n<3?r(l):n>3?r(e,o,l):r(e,o))||l);return n>3&&l&&Object.defineProperty(e,o,l),l},T=$=function(t){Object(n.a)(o,t);var e=R(o);function o(){var t;return Object(r.a)(this,o),(t=e.apply(this,arguments)).opt={dt:$.dt,dtOrder:$.dt.arr},t.addMetaData={},t.addBodyData={},t.isShow=!1,t.isLogin=!1,t.data={focus:"",metaData:{arr:[]}},t}return Object(m.a)(o,[{key:"head",value:function(){return{title:"[TASK]{{MOLLE CMS v0.1}}"}}},{key:"created",value:function(){var t=this;$.tasksMetaRef.onSnapshot((function(e){var o={arr:[]};e.forEach((function(t){o[t.id]=t.data(),o.arr.push(t.id)})),t.$set(t.data,"metaData",o)}))}},{key:"addSave",value:function(){var t=this,e=$.tasksMetaRef.doc().id,o=v.a.firestore().batch();this.addMetaData.author=v.a.auth().currentUser.uid,this.addMetaData.createTime=v.a.firestore.FieldValue.serverTimestamp(),this.addMetaData.updateTime=v.a.firestore.FieldValue.serverTimestamp(),o.set($.tasksMetaRef.doc(e),this.addMetaData),o.set($.tasksBodyRef.doc(e),this.addBodyData),o.commit().then((function(){t.isShow=!1}))}}]),o}(f.Vue);T.tasksMetaRef=v.a.firestore().collection("".concat("sandbox","/_tasks/meta/")),T.tasksBodyRef=v.a.firestore().collection("".concat("sandbox","/_tasks/body/")),T.dt={id:{jp:"ID"},title:{jp:"件名"},description:{jp:"内容"},author:{jp:"作成者"},holder:{jp:"担当者"},status:{jp:"ステータス"},priority:{jp:"優先度"},milestone:{jp:"マイルストーン"},category:{jp:"カテゴリ"},createTime:{jp:"登録"},limitDate:{jp:"〆切"},updateTime:{jp:"更新"},arr:["id","title","holder","status","priority","milestone","category","createTime","limitDate","updateTime"]};var w=T=$=x([Object(f.Component)({components:{MolleBase:O.a,TaskView:C,TextAreaQuill:h.a}})],T),B=Object(j.a)(w,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"molle-sys-ui bootstrap"},[o("MolleBase",{model:{value:t.isLogin,callback:function(e){t.isLogin=e},expression:"isLogin"}}),t.isLogin?o("div",[o("div",{staticClass:"container-fluid"},[o("table",{staticClass:"table"},[o("thead",[o("tr",t._l(t.opt.dtOrder,(function(e){return o("th",[o("span",{domProps:{innerHTML:t._s(t.opt.dt[e].jp)}})])})),0)]),o("tbody",t._l(t.data.metaData.arr,(function(e){return o("tr",{on:{click:function(o){return t.$router.replace({query:{id:e}})}}},t._l(t.opt.dtOrder,(function(r){return o("td",t._l([t.data.metaData[e][r]],(function(e){return o("span",["holder"==r?o("span",{domProps:{innerHTML:t._s(t.$getUser(e).name)}}):e&&e.toDate?o("span",{domProps:{innerHTML:t._s(t.$dateFormatter(e.toDate(),"YYYY/MM/DD"))}}):o("span",{domProps:{innerHTML:t._s(e)}})])})),0)})),0)})),0)]),t.isShow||t.$route.query.id?t._e():o("div",{staticClass:"fixed-bottom d-flex"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.addMetaData.title,expression:"addMetaData.title"}],staticClass:"form-control",attrs:{type:"text",placeholder:t.opt.dt.title.jp},domProps:{value:t.addMetaData.title},on:{input:function(e){e.target.composing||t.$set(t.addMetaData,"title",e.target.value)}}}),o("div",[o("label",{staticClass:"form-inline"},[o("select",{directives:[{name:"model",rawName:"v-model",value:t.addMetaData.holder,expression:"addMetaData.holder"}],staticClass:"form-control",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.addMetaData,"holder",e.target.multiple?o:o[0])}}},[o("option",{attrs:{value:""}},[t._v("未設定")]),t._l(t.$users,(function(e,r){return o("option",{domProps:{value:r,innerHTML:t._s(e.name)}})}))],2)])]),o("button",{staticClass:"btn-primary",on:{click:function(e){t.isShow=!0}}},[o("span",[o("b-icon",{attrs:{icon:"plus"}})],1)])])]),t.isShow?o("div",[o("div",{staticClass:"modal",attrs:{"aria-expanded":t.isShow}},[o("div",{staticClass:"modal__fiexd"},[o("div",{staticClass:"modal__close",on:{click:function(e){t.isShow=!t.isShow}}}),o("div",{staticClass:"modal__body bootstrap"},[o("label",{staticClass:"form-inline"},[o("span",{staticClass:"mr-2"},[t._v(t._s(t.opt.dt.title.jp)+":")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.addMetaData.title,expression:"addMetaData.title"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.addMetaData.title},on:{input:function(e){e.target.composing||t.$set(t.addMetaData,"title",e.target.value)}}})]),o("label",{staticClass:"form-inline"},[o("span",[t._v("担当者")]),o("select",{directives:[{name:"model",rawName:"v-model",value:t.addMetaData.holder,expression:"addMetaData.holder"}],staticClass:"form-control",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.addMetaData,"holder",e.target.multiple?o:o[0])}}},[o("option",{attrs:{value:""}},[t._v("未設定")]),t._l(t.$users,(function(e,r){return o("option",{domProps:{value:r,innerHTML:t._s(e.name)}})}))],2)]),o("label",{staticClass:"form-inline"},[o("span",{staticClass:"mr-2"},[t._v(t._s(t.opt.dt.limitDate.jp)+":")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.addMetaData.limitDate,expression:"addMetaData.limitDate"}],staticClass:"form-control",attrs:{type:"date"},domProps:{value:t.addMetaData.limitDate},on:{input:function(e){e.target.composing||t.$set(t.addMetaData,"limitDate",e.target.value)}}})]),o("TextAreaQuill",{attrs:{label:t.opt.dt.description.jp+":",toolbar:"full"},model:{value:t.addBodyData.description,callback:function(e){t.$set(t.addBodyData,"description",e)},expression:"addBodyData.description"}}),o("div",{staticClass:"d-flex"},[o("button",{staticClass:"btn-primary",on:{click:t.addSave}},[o("span",[o("b-icon",{attrs:{icon:"plus"}}),t._v("保存")],1)])])],1)])])]):t._e(),o("TaskView",{attrs:{metaData:t.data.metaData,users:t.opt.users}})],1):t._e()],1)}),[],!1,null,null,null).exports;function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,r=Object(c.a)(t);if(e){var n=Object(c.a)(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return Object(l.a)(this,o)}}var L=function(t,e,o,desc){var r,n=arguments.length,l=n<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,o):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(l=(n<3?r(l):n>3?r(e,o,l):r(e,o))||l);return n>3&&l&&Object.defineProperty(e,o,l),l},S=function(t){Object(n.a)(o,t);var e=P(o);function o(){return Object(r.a)(this,o),e.apply(this,arguments)}return o}(f.Vue),A=S=L([Object(f.Component)({components:{TasksList:B}})],S),V=Object(j.a)(A,(function(){var t=this.$createElement;return(this._self._c||t)("TasksList")}),[],!1,null,null,null);e.default=V.exports}}]);